<!doctype html>
<html lang="en">
<head>
    <!-- meta tags, links to css, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Final Project</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <!-- <div class="container-fluid">
        <div class="row fixed-top bg-light">
            <div class="col-md-12">
                <h1 class="p-3">Your Fixed Header</h1>
            </div>
        </div>
    </div> -->

    <div class="container fluid">
        <div class="row fixed-top bg-light" style="height: 100px; width: 100%;">
            <div class="col-md-12">
                <h1 class="p-3">Your Fixed Header</h1>
            </div>
        </div>

        <div class="row" style="padding: 100px; width: 100%;">
            <div class="col-12">
                <div id="recommend-posts" class="mt-3">
                </div>

                <div id="recommended-info-container" class="mt-3"></div>

                <div id="app" class="mt-3"></div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/faker@5.5.3/dist/faker.min.js"></script>
    <script>

        
        var userInteractions = [];
        var categoryInteractionCounts = {};
        var postDict = {};

        var recommendedGenerated = false;

        function handleScroll() {
            // Check if the user has scrolled to the bottom
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
                // If not already generated, generate recommended content
                if (!recommendedGenerated) {
                    recommendPosts();
                    recommendedGenerated = true;
                }
            } else {
                // Reset the flag if the user scrolls back up
                recommendedGenerated = false;
            }
        }

        // Attach the handleScroll function to the window's scroll event
        window.onscroll = handleScroll;


        function handleInteraction(postId, action, category) {
            const interaction = {
                postId,
                action,
                category,
                timestamp: new Date().toLocaleString()
            };

            // Log the interaction to the console (you can modify this to store interactions)
            console.log(`User performed ${action} on post ${postId} at ${interaction.timestamp}`);

            // Store the interaction in the userInteractions array
            userInteractions.push(interaction);

            if (category in categoryInteractionCounts) {
                categoryInteractionCounts[category]++;
            } else {
                categoryInteractionCounts[category] = 1;
            }

            // Update UI or perform other actions as needed
            
        }

        function updateInteractionUI(topCategory) {
            const interactionsContainer = document.getElementById('recommended-info-container');
            interactionsContainer.innerHTML = '<h2>User Info</h2>';

            // Display each interaction in the UI
            const interactionElement = document.createElement('div');
            interactionElement.textContent = `Your most recommended category is ${topCategory}`;
            interactionsContainer.appendChild(interactionElement);
        }

        // Example JavaScript functions to handle button clicks
        function likePost(postId) {
            const likeCountElement = document.querySelector(`#app .post:nth-child(${postId}) .like-count`);
            let likeCount = parseInt(likeCountElement.textContent) || 0;
            likeCount++;
            likeCountElement.textContent = likeCount;

            // Log the like interaction
            handleInteraction(postId, 'like', postDict[postId]);
        }

        function commentPost(postId) {
            // Add your logic for handling comments
            console.log(`Commenting on post ${postId}`);

            // Log the comment interaction
            handleInteraction(postId, 'comment', postDict[postId]);
        }

        function sharePost(postId) {
            // Add your logic for handling shares
            console.log(`Sharing post ${postId}`);

            // Log the share interaction
            handleInteraction(postId, 'share', postDict[postId]);
        }

        // function showInteractions(){
        //     for (let i = 0; i < userInteractions.length; i++){
        //         console.log("si", userInteractions[i]);
        //         updateInteractionUI();
        //     }
        // }

        function createPosts(n, category) {
            const postsContainer = document.getElementById('app');

            console.log(createPosts.arguments.length);

            postCategory = category || faker.animal.type();

            for (let i = 0; i < n; i++) {
                let userName = faker.name.firstName();
                const postElement = document.createElement('div');
                postElement.classList.add('post');
                let postCategory = category || faker.animal.type();
                const userHeader = document.createElement('div');
                userHeader.classList.add('post-header');
                userHeader.innerHTML =
                `
                    <img src="assets/img/9131529.png" class="user-avatar">
                    <div class="user-info">
                        <div class="user-name">${userName}</div>
                        <div class="user-name">@${faker.internet.userName(userName)}</div>
                        <div class="post-time">Just now</div> 
                    </div>
                `;

                const postContent = document.createElement('div');
                postContent.classList.add('post-content');
                postContent.innerHTML = `
                <img src='http://loremflickr.com/570/521/${postCategory}?=${Math.random()}'>
                <p>${faker.lorem.sentences(2)}</p>`;

                //faker.image.urlLoremFlickr({ category: 'animals' })

                const postButtons = document.createElement('div');
                postButtons.classList.add('post-buttons');
                postButtons.innerHTML = `
                    <div class="button" onclick="likePost(${i + 1})">
                        <span class="icon">üëç</span>
                        <span class="like-count">0</span>
                    </div>
                    <div class="button" onclick="commentPost(${i + 1})">
                        <span class="icon">üí¨</span> Comment
                    </div>
                    <div class="button" onclick="sharePost(${i + 1})">
                        <span class="icon">üîÑ</span> Share
                    </div>
                `;

                postElement.appendChild(userHeader);
                postElement.appendChild(postContent);
                postElement.appendChild(postButtons);
                postsContainer.appendChild(postElement);
                postDict[i+1] = postCategory;
            }
        }


        // Function to calculate category interaction counts
        function calculateCategoryCounts() {
            return categoryInteractionCounts;
        }
                // Function to recommend new posts based on category interaction counts
        function recommendPosts() {
            if(userInteractions.length == 0){
                createPosts(10);
            }
            
            else{
                const postsContainer = document.getElementById('app');
                postsContainer.innerHTML = '';
                const categoryCounts = calculateCategoryCounts();

                console.log(categoryCounts);

                // Sort categories by interaction count in descending order
                const sortedCategories = Object.keys(categoryCounts).sort((a, b) => categoryCounts[b] - categoryCounts[a]);

                // Select the top category
                const topCategory = sortedCategories[0];
                console.log(`Recommended posts based on top category '${topCategory}':`);
                if (sortedCategories.length > 1){

                    const secondCategory = sortedCategories[1];
                    console.log(`Recommended posts based on second category '${secondCategory}':`);

                } 

                console.log(sortedCategories);

                // Use the top category to recommend new posts (you can customize this part)
                console.log(`Recommended posts based on top category '${topCategory}':`);
                // for (let i = 0; i < recommendedPosts.length; i++) {
                //     const postCategory = postDict[i + 1];
                //     if (postCategory === topCategory) {
                //         console.log(`- Post ${i + 1}: ${postCategory}`);
                //     }
                // }

                let numRecommended = Math.floor((categoryCounts[topCategory] / userInteractions.length) * 10);
                console.log(numRecommended, 'numRecommended');
                console.log(userInteractions.length, 'userintlen');
                console.log(categoryCounts[topCategory], 'count');
                

                if(numRecommended < 7){
                    createPosts(numRecommended, topCategory);
                    createPosts(10 - numRecommended);
                }
                else{
                    createPosts(7, topCategory);
                    createPosts(3);
                }

                updateInteractionUI(topCategory);
            }
            
        }
        createPosts(10);
    </script>
</body>
</html>