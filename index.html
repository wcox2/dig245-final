<!DOCTYPE html>
<html lang="en">
<head>
    <!-- meta tags, links to css, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Final Project</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="container">
        <div class="row fixed-top d-flex justify-content-center" style="height: 100px; width: 100%;">
            <div class="col-10 pt-3" id="app-header">
                <h2 class=" d-flex justify-content-center">ShareSpace</h2>
                    <div class="info">
                        <button class="info-button" style="position: absolute; right: 0; top: 10px;" onclick="infoPopup()">?</button>
                    </div>

                <div class="header-buttons d-flex justify-content-center" style="width: 100%;">
                    <button class="home-button" onclick="showHome()"> Home </button>
                    <button class="home-button" onclick="showProfile()">My Profile</button>
                    <button class="home-button" onclick="showMoreInfo()">More Info</button>
                </div>
            </div>
        </div>

        <div class="row d-flex justify-content-center" style="padding: 50px; padding-top: 100px; width: 100%;">
            <div class="col-12">
                <div id="home-content">
                    <!-- Home content goes here -->
                    <div id="recommend-posts" class="mt-3"></div>
                    <div id="recommended-info-container" class="mt-3"></div>
                    <div id="app" class="mt-3"></div>
                </div>

                <div id="profile-content" class="mt-3" style="color: white; background-color: black; padding: 20px; border-radius: 10px;">
                    
                    <div id="profile-container">
                        <div class="profile-block mb-4">
                            <img src="assets/img/9131529.png" class="profile-picture" alt="Profile Picture">
                            <div class="profile-info">
                              <div class="follow-counts">
                                <div class="following-count">
                                  <h4>898 Following</h4>
                                </div>
                                <div class="follower-count">
                                  <h4>1000 Followers</h4>
                                </div>
                              </div>
                            </div>
                            
                        </div>
                        <div class="user-name-block">
                            <div class="name">
                               <h4>My Profile</h4>
                            </div>
                        </div>
                        
                          
                    </div>
                    <div id="profile-text" class="mt-3"></div>
                    <div id="chart-container" class=" d-flex justify-content-center">
                        <canvas id="interactionChart" style="width:800px; height:800px;"></canvas>
                    </div>
                    <div id="category-info" class="mt-3"></div>
                </div>
                <div id="more-info" class="mt-3" style="color: white;">
                    <div id="additional-info" class="mt-3">
                        <h2>Why is this Important?</h2>
                        <p>
                            Understanding social media algorithms is crucial because they play a significant role in shaping the information landscape, influencing the spread of content, and impacting individuals and societies in various ways. Here are several reasons why it's important to know about social media algorithms and their implications:
                        </p>
                        <ul>
                            <li>
                                <strong>Content Distribution:</strong> Social media algorithms determine what content users see on their feeds. They prioritize certain posts based on factors like relevance, engagement, and user behavior. This can shape public discourse by amplifying certain viewpoints while suppressing others.
                            </li>
                            <li>
                                <strong>Filter Bubbles and Echo Chambers:</strong> Algorithms often show users content that aligns with their existing beliefs and preferences. This can create filter bubbles and echo chambers, limiting exposure to diverse perspectives. People may be less likely to encounter information that challenges their views, contributing to polarization and reinforcing existing biases.
                            </li>
                            <li>
                                <strong>Fake News and Misinformation:</strong> Social media algorithms can inadvertently facilitate the spread of fake news and misinformation. False or sensationalized content that generates high engagement may be prioritized, leading to its widespread dissemination before fact-checking can catch up. This can have serious consequences for public opinion and decision-making.
                            </li>
                            <li>
                                <strong>Algorithmic Bias:</strong> Algorithms can inadvertently perpetuate and amplify biases present in society. If the training data used to develop these algorithms contains biases, the algorithms themselves may exhibit biased behavior. This can result in discriminatory outcomes, affecting certain groups more than others.
                            </li>
                            <li>
                                <strong>Manipulation and Exploitation:</strong> Understanding social media algorithms is essential for recognizing and addressing attempts to manipulate public opinion or exploit the platform for malicious purposes. This includes activities such as coordinated disinformation campaigns, spreading propaganda, or conducting influence operations.
                            </li>
                            <li>
                                <strong>Impact on Mental Health:</strong> Algorithms are designed to maximize user engagement, often by showing content that elicits strong emotional reactions. This can contribute to the "attention economy," where platforms prioritize content that keeps users scrolling, potentially leading to negative effects on mental health, such as anxiety, depression, or addiction.
                            </li>
                            <li>
                                <strong>Personalization and Privacy Concerns:</strong> Social media algorithms use personal data to personalize content recommendations. While this can enhance user experience, it raises concerns about privacy and the extent to which platforms track and use individual user data for advertising and other purposes.
                            </li>
                            <li>
                                <strong>Regulatory and Ethical Considerations:</strong> As social media platforms become powerful influencers in public discourse, there is a growing need for regulatory oversight and ethical guidelines to ensure responsible algorithmic behavior. Understanding these algorithms is crucial for policymakers, researchers, and the public to advocate for fair and transparent practices.
                            </li>
                        </ul>
                        <ul>
                            <li>
                                <a href="https://www.socialpilot.co/blog/social-media-algorithm#:~:text=A%20social%20media%20algorithm%20is,account%20by%20social%20media%20platforms.">Understanding Social Media Algorithms</a>
                            </li>
                            <li>
                                <a href="https://www.scientificamerican.com/article/social-media-algorithms-warp-how-people-learn-from-each-other/">Social Media Algorithms Warp How People Learn From Each Other</a>
                            </li>
                            <li>
                                <a href="https://wtvi.pbslearningmedia.org/resource/how-social-algorithms-create-echo-chambers-video/social-media-algorithms-mediawise-student-reporting-labs/">How Social Media Algorithms Create Echo Chambers</a>
                            </li>
                         </ul>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/faker@5.5.3/dist/faker.min.js"></script>

    <script>
        document.getElementById('profile-content').style.display = 'none';
        document.getElementById('more-info').style.display = 'none';
        var userInteractions = [];
        var likedPostList = new Set();
        var sharePostList = new Set();
        var categoryInteractionCounts = {};
        var postDict = {};
        var topCategory = '';
        var amountOfInteractions = 0;
        var numberOfRefresh = 0;

        var likedPost = false;

        var recommendedGenerated = false;

        function infoPopup(){
            alert('This app is designed to simplfy the way a social media algorithm recommends content to users. Interact with different posts to see how new content is tailored to your interests. Scroll to the bottom of this page tog generate new content. View your profile screen to see more detailed information.');
        }

        function renderInteractionChart(categoryCounts) {
            const ctx = document.getElementById('interactionChart').getContext('2d');

            // Destroy the previous chart instance if it exists
            if(window.interactionChart instanceof Chart)
            {
                window.interactionChart.destroy();
            }

            const labels = Object.keys(categoryCounts);
            const data = Object.values(categoryCounts);

            const chartData = {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        "#b91d47",
                        "#00aba9",
                        "#2b5797",
                        "#e8c3b9",
                        "#1e7145",
                    ],
                    borderWidth: 1
                }]
            };

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                title: {
                    display: true,
                    text: "Total Interactions by Post Category"
                }
            };

            // Create a new chart instance
            window.interactionChart = new Chart(ctx, {
                type: 'pie',
                data: chartData,
                options: chartOptions
            });
        }


        function scrollToTopAndRefresh() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            // setTimeout(() => {
            //     location.reload();
            // }, 500);
        }

        function showHome() {
            document.getElementById('home-content').style.display = 'block';
            document.getElementById('more-info').style.display = 'none';
            document.getElementById('profile-content').style.display = 'none';
            scrollToTopAndRefresh()
        }

        function showProfile() {
            document.getElementById('home-content').style.display = 'none';
            document.getElementById('more-info').style.display = 'none';
            document.getElementById('profile-content').style.display = 'block';
            const categories = calculateCategoryCounts();
            updateInteractionUI(categories);
        }

        function showMoreInfo() {
            document.getElementById('home-content').style.display = 'none';
            document.getElementById('profile-content').style.display = 'none';
            document.getElementById('more-info').style.display = 'block';
            const categories = calculateCategoryCounts();
            updateInteractionUI(categories);
        }

        window.onscroll = function(ev) {
            if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight -2) {
                if(!(document.getElementById('home-content').style.display == 'none')){
                numberOfRefresh++;
                recommendPosts();
            }
            }
        };

        function handleInteraction(postId, action, category) {
            const interaction = {
                postId,
                action,
                category,
                // timestamp: new Date().toLocaleString()
            };

            // console.log(`User performed ${action} on post ${postId} at ${interaction.timestamp}`);

            userInteractions.push(interaction);
            amountOfInteractions++;

            if (category in categoryInteractionCounts) {
                categoryInteractionCounts[category]++;
            } else {
                categoryInteractionCounts[category] = 1;
            }
        }

        function updateInteractionUI(categoryCounts) {

            const sortedCategories = Object.keys(categoryCounts).sort((a, b) => categoryCounts[b] - categoryCounts[a]);
            topCategory = sortedCategories[0];
            secondCategory = sortedCategories[1];

            const postsContainer = document.getElementById('app');
            const categoryInfo = document.getElementById('category-info');
            categoryInfo.innerHTML = '';
            const profileView = document.getElementById('profile-text');
            profileView.innerHTML = '';
            const profileContent = document.createElement('h4');
            const categoryInfoText = document.createElement('h4');
            if (userInteractions.length > 0){

                profileContent.innerHTML = `You have interacted with a post ${amountOfInteractions} times. Your most popular categories are shown below.`;
                categoryInfoText.innerHTML = `The algorithm will mostly recommend content that falls into your top two categories, ${topCategory} and ${secondCategory}, but it will also recommend some posts from random categories so you can still explore new content. This is a simplified version of a social media algorithm that was put together in about a month. Big companies such as Facebook and Instagram pour tons of money and time into developing and optimizing their algorithms. If you would like to learn more about these algorithms scroll down below.`;
                categoryInfo.appendChild(categoryInfoText);

            }else{
                profileContent.innerHTML = `You have interacted with a post ${userInteractions.length} times. Interact with posts to see how it affects the content you are recommended.`;
            }
            
            profileView.appendChild(profileContent);
            
            renderInteractionChart(categoryCounts);
        }

        function likePost(postId) {
            // document.documentElement(`#app .post:nth-child(${postId})`);
            const likeCountElement = document.getElementById(`like-${postId}`);
            
            let likeCount = parseInt(likeCountElement.textContent) || 0;

            if (!likedPostList.has(postId)) {
                likeCount++;
                likedPostList.add(postId);
                likeCountElement.textContent = likeCount;
                likeCountElement.style.color = '#3498db';
                handleInteraction(postId, 'like', postDict[postId]);
                
            } else {
                likeCount--;
                amountOfInteractions--;
                likedPostList.delete(postId);
                likeCountElement.textContent = likeCount;
                likeCountElement.style.color = 'white';
                const tupleToRemove = ['like', postDict[postId], postId];
                const index = userInteractions.findIndex(item => 
                    item[0] === tupleToRemove[0] &&
                    item[1] === tupleToRemove[1] &&
                    item[2] === tupleToRemove[2]
                );

                if (index > -1) {
                    userInteractions.splice(index, 1);
                }

                categoryInteractionCounts[postDict[postId]]--;
            }
        }

        function sharePost(postId) {
            const shareCountElement = document.getElementById(`share-${postId}`);
            if(!(sharePostList.has(postId))){
                handleInteraction(postId, 'share', postDict[postId]);
                shareCountElement.style.color = '#3498db';
                sharePostList.add(postId);
            }else {
                console.log('here')
                amountOfInteractions--;
                sharePostList.delete(postId);
                shareCountElement.style.color = 'white';
                const tupleToRemove = ['share', postDict[postId], postId];
                const index = userInteractions.findIndex(item => 
                    item[0] === tupleToRemove[0] &&
                    item[1] === tupleToRemove[1] &&
                    item[2] === tupleToRemove[2]
                );

                if (index > -1) {
                    userInteractions.splice(index, 1);
                }

                categoryInteractionCounts[postDict[postId]]--;
            }

        }

        function createPosts(n, category) {
            const postsContainer = document.getElementById('app');
            postCategory = category || faker.animal.type();

            for (let i = 0; i < n; i++) {
                let userName = faker.name.firstName();
                const postElement = document.createElement('div');
                postElement.classList.add('post');
                let postCategory = category || faker.animal.type();
                const userHeader = document.createElement('div');
                userHeader.classList.add('post-header');
                userHeader.innerHTML =
                    `
                    <img src="assets/img/9131529.png" class="user-avatar">
                    <div class="user-info">
                        <div class="user-name-block">
                            <div class="name" style="padding-right:5px;">${userName} </div>
                            <div class="user-name">@${faker.internet.userName(userName)}</div>
                        </div>
                        <div class="post-time">Just now</div> 
                    </div>
                `;

                const postContent = document.createElement('div');
                postContent.classList.add('post-content');
                postContent.innerHTML = `
                <img src='http://loremflickr.com/570/521/${postCategory}?=${Math.random()}'>
                <p style="margin-top: 20px">${faker.lorem.sentences(2)}</p>`;

                const postButtons = document.createElement('div');
                postButtons.classList.add('post-buttons');
                postButtons.innerHTML = `
                    <div class="button" onclick="likePost(${i + 1 * (numberOfRefresh * 10)})">
                        <span class="icon" style="font-size: large;">⭐</span>
                        <span class="like-count" id="like-${i + 1 * (numberOfRefresh * 10)}" style="font-size: large;">${Math.floor(Math.random() * 10000)}</span>
                    </div>
                    <div class="button" onclick="sharePost(${i + 1 * (numberOfRefresh * 10)})">
                        <span class="icon share-count" id="share-${i + 1 * (numberOfRefresh * 10)}" style="font-size: large;">🔄 Share</span> 
                    </div>
                `;

                postElement.appendChild(userHeader);
                postElement.appendChild(postContent);
                postElement.appendChild(postButtons);
                postsContainer.appendChild(postElement);
                postDict[i + 1 * (numberOfRefresh * 10)] = postCategory;
            }
        }

        function calculateCategoryCounts() {
            return categoryInteractionCounts;
        }

        function recommendPosts() {
            if (userInteractions.length == 0) {
                createPosts(10);
            } else {
                const postsContainer = document.getElementById('app');
                // const profileView = document.getElementById('profile-text');
                // profileView.innerHTML = '';
                // const profileContent = document.createElement('h4');
                // profileContent.innerHTML = `You have interacted with a post ${userInteractions.length} times. Your most popular category is ${topCategory} the algorithm will recommend simillar content`;
                // profileView.appendChild(profileContent);
                const categoryCounts = calculateCategoryCounts();

                const sortedCategories = Object.keys(categoryCounts).sort((a, b) => categoryCounts[b] - categoryCounts[a]);

                topCategory = sortedCategories[0];
                // console.log(`Recommended posts based on top category '${topCategory}':`);
                if (sortedCategories.length > 1) {
                    const secondCategory = sortedCategories[1];
                    // console.log(`Recommended posts based on second category '${secondCategory}':`);
                }

                // console.log(sortedCategories);

                // console.log(`Recommended posts based on top category '${topCategory}':`);

                let numRecommended = Math.floor((categoryCounts[topCategory] / userInteractions.length) * 10);
                // console.log(numRecommended, 'numRecommended');
                // console.log(userInteractions.length, 'userintlen');
                // console.log(categoryCounts[topCategory], 'count');

                if (numRecommended < 7) {
                    createPosts(numRecommended, topCategory);
                    createPosts(10 - numRecommended);
                } else {
                    createPosts(7, topCategory);
                    createPosts(3);
                }

                updateInteractionUI(categoryCounts);
                
            }


        }
        recommendPosts();
    </script>
</body>
</html>
