<!DOCTYPE html>
<html lang="en">
<head>
    <!-- meta tags, links to css, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Final Project</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>

    <div class="container">
        <div class="row fixed-top d-flex justify-content-center" style="height: 100px; width: 100%;">
            <div class="col-8 " id="app-header">
                <h2 class="pt-3 d-flex justify-content-center">ShareSpace</h2>

                <div class="header-buttons d-flex justify-content-center" style="width: 100%;">
                    <button class="home-button" onclick="showHome()"> Home </button>
                    <button class="home-button" onclick="showProfile()">My Profile</button>
                </div>
            </div>
        </div>

        <div class="row d-flex justify-content-center" style="padding: 100px; width: 100%;">
            <div class="col-12">
                <div id="home-content">
                    <!-- Home content goes here -->
                    <div id="recommend-posts" class="mt-3"></div>
                    <div id="recommended-info-container" class="mt-3"></div>
                    <div id="app" class="mt-3"></div>
                </div>

                <div id="profile-content" class="mt-3" style="color: white;">
                    <!-- Profile content goes here -->
                    <h3>My Profile Page</h3>
                    <!-- Add your profile content here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/faker@5.5.3/dist/faker.min.js"></script>
    <script>
        var userInteractions = [];
        var categoryInteractionCounts = {};
        var postDict = {};

        var recommendedGenerated = false;

        function scrollToTopAndRefresh() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            setTimeout(() => {
                location.reload();
            }, 500);
        }

        function showHome() {
            document.getElementById('home-content').style.display = 'block';
            document.getElementById('profile-content').style.display = 'none';
        }

        function showProfile() {
            document.getElementById('home-content').style.display = 'none';
            document.getElementById('profile-content').style.display = 'block';
        }

        function handleScroll() {
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
                if (!recommendedGenerated) {
                    recommendPosts();
                    recommendedGenerated = true;
                }
            } else {
                recommendedGenerated = false;
            }
        }

        window.onscroll = handleScroll;

        function handleInteraction(postId, action, category) {
            const interaction = {
                postId,
                action,
                category,
                timestamp: new Date().toLocaleString()
            };

            console.log(`User performed ${action} on post ${postId} at ${interaction.timestamp}`);

            userInteractions.push(interaction);

            if (category in categoryInteractionCounts) {
                categoryInteractionCounts[category]++;
            } else {
                categoryInteractionCounts[category] = 1;
            }
        }

        function updateInteractionUI(topCategory) {
            const interactionsContainer = document.getElementById('recommended-info-container');
            interactionsContainer.innerHTML = '<h2>User Info</h2>';

            const interactionElement = document.createElement('div');
            interactionElement.textContent = `Your most recommended category is ${topCategory}`;
            interactionsContainer.appendChild(interactionElement);
        }

        function likePost(postId) {
            const likeCountElement = document.querySelector(`#app .post:nth-child(${postId}) .like-count`);
            let likeCount = parseInt(likeCountElement.textContent) || 0;
            likeCount++;
            likeCountElement.textContent = likeCount;

            handleInteraction(postId, 'like', postDict[postId]);
        }

        function commentPost(postId) {
            console.log(`Commenting on post ${postId}`);
            handleInteraction(postId, 'comment', postDict[postId]);
        }

        function sharePost(postId) {
            console.log(`Sharing post ${postId}`);
            handleInteraction(postId, 'share', postDict[postId]);
        }

        function createPosts(n, category) {
            const postsContainer = document.getElementById('app');
            postCategory = category || faker.animal.type();

            for (let i = 0; i < n; i++) {
                let userName = faker.name.firstName();
                const postElement = document.createElement('div');
                postElement.classList.add('post');
                let postCategory = category || faker.animal.type();
                const userHeader = document.createElement('div');
                userHeader.classList.add('post-header');
                userHeader.innerHTML =
                    `
                    <img src="assets/img/9131529.png" class="user-avatar">
                    <div class="user-info">
                        <div class="user-name-block">
                            <div class="name" style="padding-right:5px;">${userName} </div>
                            <div class="user-name">@${faker.internet.userName(userName)}</div>
                        </div>
                        <div class="post-time">Just now</div> 
                    </div>
                `;

                const postContent = document.createElement('div');
                postContent.classList.add('post-content');
                postContent.innerHTML = `
                <img src='http://loremflickr.com/570/521/${postCategory}?=${Math.random()}'>
                <p>${faker.lorem.sentences(2)}</p>`;

                const postButtons = document.createElement('div');
                postButtons.classList.add('post-buttons');
                postButtons.innerHTML = `
                    <div class="button" onclick="likePost(${i + 1})">
                        <span class="icon">üëç</span>
                        <span class="like-count">0</span>
                    </div>
                    <div class="button" onclick="commentPost(${i + 1})">
                        <span class="icon">üí¨</span> Comment
                    </div>
                    <div class="button" onclick="sharePost(${i + 1})">
                        <span class="icon">üîÑ</span> Share
                    </div>
                `;

                postElement.appendChild(userHeader);
                postElement.appendChild(postContent);
                postElement.appendChild(postButtons);
                postsContainer.appendChild(postElement);
                postDict[i + 1] = postCategory;
            }
        }

        function calculateCategoryCounts() {
            return categoryInteractionCounts;
        }

        function recommendPosts() {
            if (userInteractions.length == 0) {
                createPosts(10);
            } else {
                const postsContainer = document.getElementById('app');
                postsContainer.innerHTML = '';
                const categoryCounts = calculateCategoryCounts();

                const sortedCategories = Object.keys(categoryCounts).sort((a, b) => categoryCounts[b] - categoryCounts[a]);

                const topCategory = sortedCategories[0];
                console.log(`Recommended posts based on top category '${topCategory}':`);
                if (sortedCategories.length > 1) {
                    const secondCategory = sortedCategories[1];
                    console.log(`Recommended posts based on second category '${secondCategory}':`);
                }

                console.log(sortedCategories);

                console.log(`Recommended posts based on top category '${topCategory}':`);

                let numRecommended = Math.floor((categoryCounts[topCategory] / userInteractions.length) * 10);
                console.log(numRecommended, 'numRecommended');
                console.log(userInteractions.length, 'userintlen');
                console.log(categoryCounts[topCategory], 'count');

                if (numRecommended < 7) {
                    createPosts(numRecommended, topCategory);
                    createPosts(10 - numRecommended);
                } else {
                    createPosts(7, topCategory);
                    createPosts(3);
                }

                updateInteractionUI(topCategory);
            }
        }
        recommendPosts();
    </script>
</body>
</html>
